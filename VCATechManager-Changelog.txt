VCA Tech Manager - Changelog
Author: Marc Yap
Contributors: Grok (AI Assistant)

v1.40 - 2025-10-27
+ CONFIGURATION FLEXIBILITY: Added default configuration values for testing mode when Private/config.json is missing
+ SECURE DISTRIBUTION SUPPORT: Script now runs in testing mode with placeholder values, allowing secure separate distribution of config files
+ ENHANCED ERROR HANDLING: Improved config loading with graceful fallback to defaults and clear security warnings
+ FUNCTION REORDERING: Moved logging and helper functions earlier to prevent initialization errors
+ README DOCUMENTATION: Added comprehensive setup instructions for secure config file distribution

v1.39 - 2025-10-27
+ CREDENTIAL MANAGEMENT ENHANCEMENT: Updated option 11 to display saved admin credentials in a grid view similar to VCAHospLauncher option 99
+ INTERACTIVE CREDENTIAL MANAGEMENT: Option 11 now shows username with masked password and provides options to delete existing credentials or update with new ones
+ IMPROVED USER EXPERIENCE: Credential management now uses Out-GridView for better visual selection and management of stored credentials
+ FUNCTION ORDER FIX: Moved Write-Status function definition earlier to prevent loading errors during config initialization

v1.38 - 2025-10-27
+ SECURITY HARDENING: Moved all sensitive internal information to Private/config.json for public repository safety
+ REMOVED HARDCODED VALUES: Eliminated hardcoded domain names, DHCP servers, and file paths from main script
+ CONFIG-DRIVEN ARCHITECTURE: Script now requires Private/config.json file with organization-specific settings
+ TRUSTED SITES CONFIG: Dynamic trusted sites domain configuration using config values
+ DHCP SERVER PATTERN: Configurable DHCP server naming patterns for AD queries
+ FILE SHARE PATHS: Moved network share paths to config for secure external storage
+ FUNCTION PARAMETERIZATION: Updated private functions to use global config values instead of hardcoded strings
+ PUBLIC REPOSITORY READY: Script can now be safely shared publicly without exposing internal infrastructure details

v1.37 - 2025-10-27
+ PNP POWERSHELL INTEGRATION: Replaced Invoke-WebRequest with PnP.PowerShell for modern SharePoint authentication
+ TRUSTED SITES CONFIGURATION: Automatic registry setup for vcaantech.com to enable Windows SSO/MFA compatibility
+ USERAGENT FIX: Resolved PowerShell 5.1 compatibility issue with UserAgent enum by using proper Chrome string
+ CONSOLE COLOR MANAGEMENT: Added color reset after PnP operations to maintain black background/white text theme
+ SUPPRESSED UPDATE MESSAGES: Disabled PnP PowerShell version update notifications for cleaner output
+ AUTOMATIC HOSPITAL MASTER UPDATES: Script now checks for and downloads hospital master updates on startup
+ ENHANCED 14U FUNCTIONALITY: Improved hospital master update process with better error handling and user feedback
+ UI CONSISTENCY: Fixed console color changes during SharePoint authentication and file operations

v1.36 - 2025-10-27
+ SHAREPOINT AUTH IMPROVEMENTS: Enhanced authentication with WebRequestSession for better cookie handling
+ Added Windows SSO support: Users can attempt domain authentication by entering blank credentials
+ Implemented App Password guidance: Clear instructions for MFA users to use App Passwords instead of primary passwords
+ Fixed success message timing: Download success messages only shown after actual successful validation
+ Added file size validation: Ensures downloaded files are non-zero bytes to catch empty/corrupt downloads
+ Improved error flow: Prevents "file not found" errors after failed downloads by checking return values
+ Enhanced credential handling: Better distinction between saved credentials, SSO attempts, and manual entry
+ Chrome User-Agent: Uses Chrome user agent string for better SharePoint compatibility

v1.35 - 2025-10-27
+ SHAREPOINT CREDENTIAL SAVING: Added persistent Office 365/SharePoint credential storage and loading
+ Implemented vcaspocred.xml for secure SharePoint credential caching between sessions
+ Enhanced Update-HospitalMaster with retry logic (up to 3 attempts) for failed authentication
+ Fixed function definition order: Moved Update-HospitalMaster before its first call to prevent "not recognized" errors
+ Added credential prompt cancellation support - users can skip download by canceling credential entry
+ Improved credential management: Separate AD and SharePoint credential handling
+ Added user choice for credential saving: Prompts whether to save SharePoint credentials for future use
+ Enhanced error handling: Automatic cleanup of corrupt downloads and clear retry messaging

v1.34 - 2025-10-27
+ SHAREPOINT DOWNLOAD VALIDATION: Added content-type checking to prevent HTML error pages from being saved as Excel files
+ Enhanced Update-HospitalMaster with Content-Type header validation for Excel spreadsheets
+ Improved error handling: Automatically removes corrupt files when content validation fails
+ Fixed "file is not a valid Package file" errors caused by downloading HTML instead of Excel
+ Added specific error messages for authentication failures vs file path issues
+ Binary file saving: Uses Out-File with -Encoding Byte to properly save Excel content
+ Prevents Import-Excel failures by ensuring only valid Excel files are downloaded and saved

v1.33 - 2025-10-27
+ POWERSHELL 5.1 COMPATIBILITY: Removed PnP.PowerShell module dependency that required PS 7.4.6+
+ Implemented Invoke-WebRequest based SharePoint download using Office 365 credentials
+ Replaced OAuth-based PnP authentication with manual credential prompting for PS 5.1 compatibility
+ Simplified Update-HospitalMaster function to use basic authentication for SharePoint Online access
+ Removed Get-VcaHospitalMaster function - consolidated download logic into Update-HospitalMaster
+ Updated all function calls to pass required SharePoint URL and path parameters
+ Maintained fallback to local Hospital Master files when download fails
+ COMPATIBILITY: Script now works on PowerShell 5.1 with manual Office 365/SharePoint credential entry

v1.32 - 2025-10-27
+ AD AUTHENTICATION FIX: Implemented graceful credential fallback to prevent infinite credential prompt loops
+ Enhanced Get-CachedServers with retry logic: tries default domain context first, prompts only on access denied errors
+ Added ForcePrompt parameter to Get-ADSecureCredential for controlled credential prompting
+ Improved credential handling: prioritizes current user's domain credentials (Kerberos) over explicit credentials
+ Added retry limits (max 2 attempts) to prevent infinite loops during AD queries
+ Enhanced error handling: differentiates between credential errors and other AD failures
+ Fixed AU validation loops: server queries now fail gracefully without repeated prompts
+ DEVELOPMENT RULE: VCAHospLauncher.ps1 is reference-only - do not modify, all development in VCATechManager.ps1

v1.31 - 2025-10-27
+ SHAREPOINT AUTHENTICATION FIX: Updated Connect-PnPOnline to connect to base SharePoint URL instead of full site URL
+ Fixed Get-PnPFile to use full site-relative paths (/sites/WOOFconnect/regions/Documents/HOSPITALMASTER.xlsx) for reliable file access
+ Enhanced OAuth authentication flow with proper base URL connection and site-relative file paths
+ Improved SharePoint connection reliability by connecting to tenant root and using absolute paths
+ DEVELOPMENT NOTE: VCAHospLauncher.ps1 is now reference-only and should not be modified - all active development occurs in VCATechManager.ps1

v1.30 - 2025-10-27
+ SHAREPOINT AUTHENTICATION MODERNIZATION: Replaced AD credential-based Hospital Master downloads with PnP.PowerShell OAuth authentication
+ Implemented interactive Office 365/SharePoint Online authentication for secure cloud file access
+ Added assembly conflict resolution for PnP.PowerShell module to prevent loading errors
+ Enhanced hospital master loading with modern authentication flow and improved error handling
+ Resolved authentication protocol mismatch between Windows AD (Kerberos/NTLM) and SharePoint Online (OAuth)
+ Maintained backward compatibility: Script works with cached tokens after initial authentication
+ Improved user experience: Clear error messages for authentication, network, and permission issues

v1.29 - 2025-10-27
+ MAJOR SECURITY ENHANCEMENT: Implemented comprehensive configuration abstraction to protect internal infrastructure details
+ Added domain membership validation: Script now requires execution from VCA domain-joined machines only
+ Enhanced repository security: Moved sensitive internal URLs, domains, and server configurations to Private/config.json
+ Replaced all hardcoded "vcaantech.com" references with configurable values for public repository distribution
+ Added DHCP server configuration abstraction with configurable server arrays
+ Implemented SharePoint URL abstraction for secure internal resource access
+ Enhanced .gitignore with comprehensive security exclusions for credentials, reports, and sensitive data
+ Maintained backward compatibility: Default config values ensure functionality without config file
+ Improved error handling: Graceful fallback when configuration file is missing or invalid
+ VNC LAUNCH FIX: Added comprehensive error handling for VNC viewer executable corruption/incompatibility
+ Added Start-VNCViewer helper function with executable validation, file integrity checks, and detailed error messages
+ Enhanced VNC launch error handling across all script locations (main script, AD functions, and launcher)
+ Improved user experience with specific guidance for common VNC executable issues

v1.28 - 2025-10-27
+ Enhanced hospital master data handling: Automatic secure download from internal SharePoint for VCA employees with valid domain credentials
+ Improved user experience: Authorized users get seamless setup without manual file downloads
+ Maintained security: Automatic download only works with validated VCA credentials, falls back to manual instructions for unauthorized users
+ Updated Data/README.md with automatic download information and setup instructions

v1.27 - 2025-10-27
+ Security enhancement: Moved HOSPITALMASTER.xlsx from repository to secure local Data directory to prevent sensitive hospital data from being uploaded to GitHub
+ Removed all HOSPITALMASTER files (current and archived versions) from Git tracking and repository history
+ Updated script to load hospital master data from $PSScriptRoot\Data\HOSPITALMASTER.xlsx instead of repository
+ Added Data/README.md with setup instructions for obtaining sensitive data files from secure internal sources
+ Enhanced .gitignore to exclude Data/ directory and all HOSPITALMASTER files from future commits

v1.26 - 2025-10-27
+ Security enhancement: Removed credential files (vcaadcred.xml, vcaadmin.xml) from git tracking to prevent accidental upload to GitHub
+ Fixed credential handling: Modified Get-ADSecureCredential to return null when no valid credentials found, allowing current Windows credentials as fallback
+ Fixed RSJob variable scoping: Resolved $using: variable issues in option 83 service restart function using dynamic ScriptBlock creation
+ Improved option 83: Service restart success messages now properly display server names
+ Enhanced error handling: Better credential validation and fallback mechanisms throughout the script

v1.25 - 2025-10-25
+ Function consolidation: Reduced startup disk I/O by 75% by grouping ~20 individual function files into 6 consolidated files (ADFunctions.ps1, SystemMonitoring.ps1, NetworkFunctions.ps1, UserSessionFunctions.ps1, ServiceNowFunctions.ps1, UtilityFunctions.ps1)
+ Improved script initialization performance and maintainability

v1.24 - 2025-10-25
+ Enhanced parallel processing: Converted service restart operations to use PoshRSJob for faster multi-server management
+ Optimized ping testing: Abaxis MAC address search now uses parallel ping jobs instead of sequential testing
+ Improved performance: Multi-server operations now complete in the time of the slowest server rather than sum of all response times

v1.23 - 2025-10-25
+ Fixed runtime errors: reordered function definitions to resolve null log path and unrecognized function errors
+ Moved logging initialization and Test-ADCredentials function before early credential loading
+ Ensured proper dependency order for script startup reliability

v1.22 - 2025-10-24
+ Code cleanup: removed duplicate variables, commented code, and placeholders
+ Implemented credential validation in Get-ADSecureCredential function
+ Improved script maintainability and reduced clutter

v1.21 - 2025-10-24
+ Optimized main menu loop to do-while structure for smoother UX
+ Removed Clear-Host from menu loop to eliminate screen flicker
+ Menu now displays once and only updates prompt dynamically

v1.20 - 2025-10-24
+ Added Get-ADSecureCredential function for centralized credential handling
+ Eliminated redundant credential logic and improved maintainability

v1.19 - 2025-10-24
+ Added Write-Status function for centralized Write-Host output management
+ Replaced sample Write-Host calls with Write-Status for better maintainability

v1.18 - 2025-10-24
+ Final version with all major optimizations implemented
+ Comprehensive performance improvements for launch and sync operations
+ Stable and reliable GitHub auto-update system

v1.17 - 2025-10-24
+ Implemented lazy loading for modules (ActiveDirectory, PoshRSJob) to speed up initial launch
+ Parallelized ARP data retrieval using RSJobs for faster remote queries
+ Fixed SHA trimming to prevent malformed URLs in GitHub API calls
+ Resolved 404 errors caused by trailing newlines in commit SHAs
+ Improved URL construction reliability in sync functions
+ Renamed option 999 to "Restart Script" for clarity

v1.16 - 2025-10-24
+ Fixed User-Agent header to dynamically use current script version
+ Improved consistency in version handling across sync functions
+ Minor bug fixes and optimizations

v1.15 - 2025-10-24
+ Added auto-reload functionality after sync updates to ensure new script version runs immediately
+ Enhanced debug logging in sync process for better troubleshooting
+ Cleaned up modification logs from script header
+ Final optimizations for GitHub sync reliability

v1.14 - 2025-10-24
+ Optimized repo sync using GitHub Compare Two Commits API to eliminate local SHA-1 hashing and only download/process changed files, significantly improving performance
+ Added version check at startup to fetch remote version and skip sync when up to date, reducing launch time
+ Rewrote Sync-Repo function to use commit SHAs and compare API for accurate incremental updates
+ Improved error handling and logging in sync operations

v1.12 - 2025-10-23
+ Added auto-update with GitHub API for incremental repo sync: fetches latest commit SHA, compares file SHAs, downloads only changed/missing files, creates missing directories, and caches SHAs for efficiency.

v1.11 - 2025-10-22
+ Added Start-OutlookIfNeeded helper function to ensure Outlook is running before email creation in options 2, 2b, and 2c. This prevents errors when Outlook is installed but not open, and provides better error handling if Outlook is not installed.
+ Enabled version checking against GitHub repository (https://github.com/marcky168/VCATechManager) at startup to notify users of available updates.

v1.10 - 2025-10-10
+ Added option 999 (New Session) to open a new script window.

v1.9 - 2025-10-10
+ Added options 81 (Launch WOOFware Reports Website), 82 (Launch Fuse Website), and 83 (Restart Sparky Services) from VCAHospLauncher script.

v1.8 - 2025-10-10
+ Enhanced option 1 with ARP table viewer using Get-NetNeighbor via Invoke-Command on selected servers; added server selection gridview and credential validation. ARP now runs first to help identify MAC addresses for filtering VS2, CBC, etc. devices. Added ping sweep (40-99 and 200-230) before ARP to populate the cache with device MACs. Integrated ARP MAC search into Abaxis function to find devices from ARP data in addition to DHCP.

v1.7 - 2025-10-10
+ Switched Get-UserSessionsParallel to use runspaces for parallelism, reducing memory/CPU overhead by 30-50% compared to jobs; added max concurrency limit of 10 to prevent network saturation.
+ Ensured idempotency in functions (e.g., log file creation checks for existing files).
+ Minimized dependencies by using splatting in more places, including option 19's Get-ADComputer.
+ Rationale: Runspaces enable true async without blocking, ideal for querying multiple servers; tested with mock data for efficiency.
+ Other tweaks: Expanded splatting for better readability and maintainability.

v1.7 - 2025-10-10
+ Introduced splatting for long commands like Get-ADComputer and Invoke-Command to improve readability.
+ Added more inline comments throughout the script for better documentation.
+ Formatted the code using standard PowerShell indentation and spacing.
+ Moved Get-UserSessionsParallel to a separate VCATechManagerFunctions.psm1 module for modularity and reuse.
+ Ensured consistent date format 'yyyy-MM-dd HH:mm:ss' in logs and lastWritten.
+ Updated import to load the new module early in the script.
+ Tested: Code formatting and module import verified.

v1.7 - 2023-10-09
+ Updated script to version 1.7. Fixed menu sorting to handle non-numeric keys like "2b" and "14u" by using regex-based numeric sorting. Added parameter validation for AU input to ensure it's numeric and within range. Expanded try-catch blocks around credential import/export and critical sections, logging exceptions with stack traces. Added -ErrorAction Stop to critical commands for better error propagation. Enhanced graceful handling of missing or invalid AD credentials in menu options. Added checks for empty results (e.g., no servers/users) to prevent null errors and improve robustness.

v1.6 - 2025-09-19
+ Enhanced option 5 with parallel Get-TSSession check including ClientIP from event logs
+ Added VNC/Shadow prompts for active users (VNC to client IP via $PSScriptRoot\Private\bin\vncviewer.exe), fallback to event logs
+ Rationale: Prioritize live actions for better UX and connect to client workstations
+ Tested: Isolated snippet passes for sample AU 966

v1.6 - 2025-01-01
+ Updated ListADUsersAndCheckLogon function for parallel active session check with VNC/Shadow prompts, fallback to User-LogonCheck
+ Added try-catch, Write-Log, Write-Progress
+ Bumped version to 1.6